"use strict";var v=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var r=(s,t,e)=>(v(s,t,"read from private field"),e?e.call(s):t.get(s)),a=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},i=(s,t,e,h)=>(v(s,t,"write to private field"),h?h.call(s,e):t.set(s,e),e);var R=(s,t,e)=>(v(s,t,"access private method"),e);const A=require("./browser-CpzFX2xg.cjs");var l,o,S;class M{constructor(){a(this,l,null);a(this,o,"");a(this,S,"");A.isBrowser&&(i(this,o,document.documentElement.getAttribute("data-project")||"unnamed"),i(this,S,r(this,o)?r(this,o)+"-store-registry":"store-registry"))}get projectName(){return r(this,o)}get localStoreRegistryName(){return r(this,S)}get loadedState(){return r(this,l)}saveState(){const t=this.getState(),e=JSON.stringify(t);localStorage.setItem(r(this,S),e)}loadState(t=localStorage.getItem(r(this,S))){t&&(typeof t=="string"?i(this,l,JSON.parse(t)):i(this,l,t),u.current.forEach(e=>{this.updateStore(e)}))}resetState(){u.current.forEach(t=>{t.reset()}),this.saveState()}updateStore(t){var h,w;if(!Array.isArray((h=r(this,l))==null?void 0:h.stores))return t;const e=t.passport;if(e){const N=(w=r(this,l))==null?void 0:w.stores.find(z=>z.name===e.name);N&&(t.current=N.value)}return t}getState(){const t={stores:[]};return u.current.forEach(e=>{e.passport&&(t.stores.find(h=>h.name===e.passport.name)||t.stores.push({value:e.current,name:e.passport.name}))}),t}}l=new WeakMap,o=new WeakMap,S=new WeakMap;const E=new M;var d,m,g,f,y,n,b,c,p,q;class j{constructor(t,e){a(this,p);a(this,d,void 0);a(this,m,void 0);a(this,g,void 0);a(this,f,void 0);a(this,y,void 0);a(this,n,new Set);a(this,b,void 0);a(this,c,void 0);i(this,d,e==null?void 0:e.passport),i(this,m,t),i(this,g,void 0),i(this,f,t),i(this,y,(e==null?void 0:e.equalityCheck)||((h,w)=>h===w)),e!=null&&e.validate&&this.addMiddleware(e.validate),i(this,b,(e==null?void 0:e.skipSubscribeNotification)||!1),r(this,d)&&E.updateStore(this)}get passport(){return r(this,d)}get initial(){return r(this,m)}get previous(){return r(this,g)}get current(){return r(this,f)}set current(t){if(!r(this,y).call(this,r(this,f),t)){if(i(this,g,r(this,f)),r(this,c))for(const e of r(this,c))t=e(t);i(this,f,t),R(this,p,q).call(this)}}get subscribers(){return r(this,n)}get entry(){return{current:r(this,f),previous:r(this,g)}}addMiddleware(t){r(this,c)||i(this,c,new Set),r(this,c).add(t)}removeMiddleware(t){var e,h;(e=r(this,c))==null||e.delete(t),(h=r(this,c))!=null&&h.size||i(this,c,void 0)}subscribe(t){return r(this,d)&&!r(this,n).size&&C(this),r(this,n).add(t),r(this,b)||t(this.entry),()=>{this.unsubscribe(t)}}unsubscribe(t){r(this,n).delete(t),r(this,d)&&!r(this,n).size&&k(this)}reset(){this.current=this.initial}close(){r(this,n).clear(),r(this,d)&&k(this)}}d=new WeakMap,m=new WeakMap,g=new WeakMap,f=new WeakMap,y=new WeakMap,n=new WeakMap,b=new WeakMap,c=new WeakMap,p=new WeakSet,q=function(){for(const t of r(this,n))t(this.entry)};const u=new j([]);function C(s){u.current.includes(s)||(u.current=[...u.current,s])}function k(s){u.current.includes(s)&&(u.current=u.current.filter(t=>t!==s))}exports.Store=j;exports.activeStores=u;exports.storeRegistry=E;

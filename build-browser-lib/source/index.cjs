"use strict";var v=(i,r,t)=>{if(!r.has(i))throw TypeError("Cannot "+t)};var e=(i,r,t)=>(v(i,r,"read from private field"),t?t.call(i):r.get(i)),n=(i,r,t)=>{if(r.has(i))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(i):r.set(i,t)},l=(i,r,t,a)=>(v(i,r,"write to private field"),a?a.call(i,t):r.set(i,t),t);var E=(i,r,t)=>(v(i,r,"access private method"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const L=require("../SourceManager-CI6NfLzW.cjs"),C=require("../custom-element/index.cjs"),A=require("../intersector/index.cjs"),y=require("../loading/index.cjs"),M=require("../notifier/index.cjs");let N=0;var o,s,h,m,c,u,f,g,b,x,p;class k extends C.CustomElement{constructor(){super();n(this,b);n(this,o,null);n(this,s,null);n(this,h,!1);n(this,m,!1);n(this,c,!1);n(this,u,void 0);n(this,f,new M.Notifier);n(this,g,new M.Notifier);n(this,p,t=>{e(this,c)&&!e(this,m)&&t.isIntersecting&&(e(this,o).current&&e(this,o).current!==e(this,o).previous&&E(this,b,x).call(this,e(this,o).current),l(this,m,!0)),t.isIntersecting?e(this,f).notify():e(this,g).notify()});l(this,u,`source-consumer-${++N}`)}get consumerElement(){return e(this,s)}get captureEvent(){return e(this,f)}get releaseEvent(){return e(this,g)}connectedCallback(){const t=this.getAttribute("srcset");t&&(l(this,s,this.createConsumer()),e(this,s).style.cssText=`
        display: block;
        width: 100%;
        height: 100%;
      `,e(this,s).classList.add("source-consumer"),Array.from(this.attributes).forEach(a=>{if(a.nodeName.startsWith("e-")){const S=a.nodeName.slice(2),d=a.nodeValue||"";e(this,s).setAttribute(S,d),e(this,s)[S]=d||!0}}),this.appendChild(e(this,s)),l(this,o,new L.SourceManager({srcset:t})),l(this,c,this.hasAttribute("lazy")),e(this,o).subscribe(a=>{(!e(this,c)||e(this,c)&&e(this,m))&&E(this,b,x).call(this,a.current)}),A.intersector.subscribe(this,e(this,p)),e(this,o).connect())}disconnectedCallback(){A.intersector.unsubscribe(e(this,p)),e(this,f).close(),e(this,g).close(),e(this,o).close(),e(this,s).onloadeddata=null,e(this,s).onload=null,e(this,s).onerror=null,e(this,s).remove()}}o=new WeakMap,s=new WeakMap,h=new WeakMap,m=new WeakMap,c=new WeakMap,u=new WeakMap,f=new WeakMap,g=new WeakMap,b=new WeakSet,x=function(t){if(e(this,s).onloadeddata=null,e(this,s).onload=null,e(this,s).onerror=null,t){const a=this.hasAttribute("keep-source-parameters");this.classList.remove("loaded"),this.classList.add("loading");const S=a?t.url:t.name+t.extension;this.consumeSource(S);const d=()=>{this.classList.remove("error"),this.classList.remove("loading"),this.classList.add("loaded"),!e(this,c)&&!e(this,h)&&y.loading.setLoaded(e(this,u),1),l(this,h,!0)},q=()=>{this.classList.remove("loading"),this.classList.add("error"),!e(this,c)&&!e(this,h)&&y.loading.setError(e(this,u),S),l(this,h,!0)};!e(this,c)&&!e(this,h)&&y.loading.setTotal(e(this,u),1),e(this,s).onloadeddata=()=>{d()},e(this,s).onload=()=>{d()},e(this,s).onerror=q}else this.consumeSource(null)},p=new WeakMap;exports.Source=L.Source;exports.SourceManager=L.SourceManager;exports.SourceSet=L.SourceSet;exports.SourceElement=k;

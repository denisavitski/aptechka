"use strict";var L=(h,s,e)=>{if(!s.has(h))throw TypeError("Cannot "+e)};var i=(h,s,e)=>(L(h,s,"read from private field"),e?e.call(h):s.get(h)),r=(h,s,e)=>{if(s.has(h))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(h):s.set(h,e)},t=(h,s,e,n)=>(L(h,s,"write to private field"),n?n.call(h,e):s.set(h,e),e);var q=(h,s,e)=>(L(h,s,"access private method"),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const B=require("../intersector/index.cjs"),S=require("../browser-CpzFX2xg.cjs");var f,l,y,b,m,u,o,k;class V{constructor(s,e){r(this,f,void 0);r(this,l,void 0);r(this,y,void 0);r(this,b,0);r(this,m,0);r(this,u,0);r(this,o,!1);r(this,k,s=>{t(this,o,s.isIntersecting)});t(this,f,s),t(this,l,e==null?void 0:e.maxFPS),t(this,y,(e==null?void 0:e.order)||0),e!=null&&e.culling&&S.isBrowser?B.intersector.subscribe(e.culling,i(this,k)):t(this,o,!0)}get callback(){return i(this,f)}get order(){return i(this,y)}sync(s){t(this,b,s-i(this,u))}tick(s){if(t(this,u,Math.max(0,s-i(this,b))),i(this,m)||t(this,m,s),i(this,l))if(i(this,u)>=1e3/i(this,l))t(this,b,s-i(this,u)%i(this,l));else return;else t(this,b,s);i(this,o)&&i(this,f).call(this,{elapsed:i(this,u),timestamp:s,startTimestamp:i(this,m)})}destroy(){B.intersector.unsubscribe(i(this,k))}}f=new WeakMap,l=new WeakMap,y=new WeakMap,b=new WeakMap,m=new WeakMap,u=new WeakMap,o=new WeakMap,k=new WeakMap;var F,d,a,g,c,A,P,T,x,v,w;class E{constructor(){r(this,A);r(this,T);r(this,F,0);r(this,d,0);r(this,a,void 0);r(this,g,!1);r(this,c,[]);r(this,v,s=>{if(i(this,g)){t(this,g,!1),t(this,F,s-i(this,d));for(const e of i(this,c))e.sync(i(this,d))}t(this,a,requestAnimationFrame(i(this,v))),t(this,d,s-i(this,F));for(const e of i(this,c))e.tick(i(this,d))});r(this,w,()=>{document.hidden&&t(this,g,!0)});S.isBrowser&&document.addEventListener("visibilitychange",i(this,w))}subscribe(s,e){if(!i(this,c).find(n=>n.callback===s)){const n=new V(s,e);n.sync(performance.now()),i(this,c).push(n),t(this,c,i(this,c).sort((I,M)=>I.order-M.order))}return q(this,A,P).call(this),()=>this.unsubscribe(s)}unsubscribe(s){const e=i(this,c).filter(n=>n.callback===s);e.length&&(e.forEach(n=>n.destroy()),t(this,c,i(this,c).filter(n=>n.callback!==s)),i(this,c).length||q(this,T,x).call(this))}destroy(){S.isBrowser&&(q(this,T,x).call(this),document.removeEventListener("visibilitychange",i(this,w)))}}F=new WeakMap,d=new WeakMap,a=new WeakMap,g=new WeakMap,c=new WeakMap,A=new WeakSet,P=function(){i(this,c).length&&!i(this,a)&&t(this,a,requestAnimationFrame(i(this,v)))},T=new WeakSet,x=function(){i(this,a)&&(cancelAnimationFrame(i(this,a)),t(this,a,void 0))},v=new WeakMap,w=new WeakMap;const j=new E;exports.Ticker=E;exports.ticker=j;

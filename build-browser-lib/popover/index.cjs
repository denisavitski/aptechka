"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const $=require("../attribute/index.cjs"),M=require("../custom-element/index.cjs"),A=require("../Store-D0_rDIsE.cjs"),q=require("../style-At6aDoqG.cjs"),x=require("../abstract-elements/index.cjs");var B=Object.defineProperty,D=Object.getOwnPropertyDescriptor,I=(t,e,s,i)=>{for(var n=i>1?void 0:i?D(e,s):e,c=t.length-1,l;c>=0;c--)(l=t[c])&&(n=(i?l(e,s,n):l(n))||n);return i&&n&&B(e,s,n),n},W=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},r=(t,e,s)=>(W(t,e,"read from private field"),s?s.call(t):e.get(t)),o=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},k=(t,e,s,i)=>(W(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),T=(t,e,s)=>(W(t,e,"access private method"),s),P,a,m,p,E,v,S,C,u,f,w,g,y,L,_;exports.PopoverElement=class extends M.CustomElement{constructor(){super(...arguments),o(this,S),o(this,u),o(this,y),o(this,P,-1),o(this,a,new A.Store(!1)),o(this,m,void 0),o(this,p,new $.Attribute(this,"history",!1)),o(this,E,new $.Attribute(this,"single",!1)),o(this,v,!1),this.open=()=>{r(this,a).current||(r(this,a).current=!0,r(this,E).current&&(exports.PopoverElement.__opened.forEach(e=>e.close()),exports.PopoverElement.__opened=[]),exports.PopoverElement.__opened.push(this),k(this,P,exports.PopoverElement.__opened.length-1),r(this,p).current&&r(this,v)&&history.pushState("","",r(this,S,C)),clearTimeout(r(this,m)),this.classList.add("triggered"),this.style.display="block",setTimeout(()=>{addEventListener("click",r(this,w)),addEventListener("keydown",r(this,g)),this.style.opacity="1",this.classList.add("opened")}))},this.close=()=>{r(this,a).current&&(r(this,a).current=!1,exports.PopoverElement.__opened=exports.PopoverElement.__opened.filter(e=>e!==this),r(this,p).current&&history.replaceState("","",location.href.replace(new RegExp(`[&?]${r(this,u,f)}`,"g"),"")),this.classList.remove("opened"),this.style.opacity="0",removeEventListener("click",r(this,w)),removeEventListener("keydown",r(this,g)),setTimeout(()=>{this.classList.remove("triggered"),this.style.display="none"},q.getElementTransitionDurationMS(this)))},o(this,w,e=>{T(this,y,L).call(this,()=>{const s=e.composedPath();(!s.find(i=>i===this)&&!s.find(i=>i instanceof HTMLElement&&i.closest("e-popover-button"))||s[0]instanceof HTMLElement&&s[0].hasAttribute("outside"))&&this.close()})}),o(this,g,e=>{T(this,y,L).call(this,()=>{e.code==="Escape"&&this.close()})}),o(this,_,()=>{k(this,v,!1),r(this,a).current&&r(this,p).current&&!location.search.includes(r(this,u,f))?this.close():!r(this,a).current&&r(this,p).current&&location.search.includes(r(this,u,f))&&this.open(),k(this,v,!0)})}get history(){return r(this,p)}get single(){return r(this,E)}get opened(){return r(this,a)}connectedCallback(){this.style.opacity="0",this.style.display="none",addEventListener("popstate",r(this,_)),setTimeout(()=>{r(this,_).call(this)},0)}disconnectedCallback(){clearTimeout(r(this,m)),removeEventListener("popstate",r(this,_))}};P=new WeakMap;a=new WeakMap;m=new WeakMap;p=new WeakMap;E=new WeakMap;v=new WeakMap;S=new WeakSet;C=function(){return`${location.pathname}${location.search?location.search+"&":"?"}${r(this,u,f)}`};u=new WeakSet;f=function(){return`modal-${this.id}`};w=new WeakMap;g=new WeakMap;y=new WeakSet;L=function(t){(exports.PopoverElement.__opened[r(this,P)-1]||exports.PopoverElement.__opened.length===1)&&t()};_=new WeakMap;exports.PopoverElement.__opened=[];exports.PopoverElement=I([M.define("e-popover")],exports.PopoverElement);var N=Object.defineProperty,G=Object.getOwnPropertyDescriptor,H=(t,e,s,i)=>{for(var n=i>1?void 0:i?G(e,s):e,c=t.length-1,l;c>=0;c--)(l=t[c])&&(n=(i?l(e,s,n):l(n))||n);return i&&n&&N(e,s,n),n},O=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},d=(t,e,s)=>(O(t,e,"read from private field"),s?s.call(t):e.get(t)),R=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},b=(t,e,s,i)=>(O(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),h;exports.PopoverButtonElement=class extends x.AbstractButtonElement{constructor(){super(...arguments),R(this,h,void 0)}get popoverElement(){return d(this,h)}click(){if(d(this,h)){const e=this.getAttribute("type")||"open";e==="open"||e==="toggle"&&!d(this,h).opened.current?d(this,h).open():(e==="close"||e==="toggle"&&d(this,h).opened.current)&&d(this,h).close()}}connectedCallback(){const e=this.getAttribute("target");if(e){const s=document.querySelector(`#${e}`)||this.getRootNode().querySelector(`#${e}`);s?b(this,h,s):console.warn(this,`target ${e} not found`)}}};h=new WeakMap;exports.PopoverButtonElement=H([M.define("e-popover-button")],exports.PopoverButtonElement);

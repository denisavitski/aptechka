"use strict";var M=(o,n,t)=>{if(!n.has(o))throw TypeError("Cannot "+t)};var e=(o,n,t)=>(M(o,n,"read from private field"),t?t.call(o):n.get(o)),i=(o,n,t)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,t)},h=(o,n,t,a)=>(M(o,n,"write to private field"),a?a.call(o,t):n.set(o,t),t);var O=(o,n,t)=>(M(o,n,"access private method"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const H=require("../attribute/index.cjs"),P=require("../Store-Cr3VaD9G.cjs"),B=require("../style-At6aDoqG.cjs"),I=require("../browser-CpzFX2xg.cjs");require("../ticker/index.cjs");const j=require("../tags-B0do5eeb.cjs");var f,l,b,p,d,u,A,R,v,y,E,L,T,$,g;const c=class c extends HTMLElement{constructor(){super();i(this,A);i(this,v);i(this,T);i(this,f,void 0);i(this,l,void 0);i(this,b,void 0);i(this,p,void 0);i(this,d,void 0);i(this,u,void 0);i(this,E,void 0);i(this,L,void 0);i(this,g,void 0);h(this,f,-1),h(this,l,new P.Store(!1)),h(this,p,new H.Attribute(this,"history",!1)),h(this,d,new H.Attribute(this,"single",!1)),h(this,u,!1),this.open=(t=!0)=>{if(e(this,l).current)return;e(this,l).current=!0,e(this,d).current&&(c.__opened.forEach(r=>r.close()),c.__opened=[]),c.__opened.push(this),h(this,f,c.__opened.length-1),e(this,p).current&&e(this,u)&&history.pushState("","",e(this,A,R)),clearTimeout(e(this,b)),this.classList.add("triggered"),this.style.display="block",this.dispatchEvent(new CustomEvent("popoverTriggered"));const a=()=>{addEventListener("click",e(this,E)),addEventListener("keydown",e(this,L)),this.style.opacity="1",this.classList.add("opened"),this.dispatchEvent(new CustomEvent("popoverOpened"))};t?setTimeout(a):a()},this.close=()=>{if(e(this,l).current){if(e(this,l).current=!1,c.__opened=c.__opened.filter(t=>t!==this),e(this,p).current){const t=new URL(location.href);t.searchParams.delete(e(this,v,y)),history.replaceState(null,"",t.href)}this.classList.remove("opened"),this.style.opacity="0",this.dispatchEvent(new CustomEvent("popoverClosing")),removeEventListener("click",e(this,E)),removeEventListener("keydown",e(this,L)),setTimeout(()=>{this.classList.remove("triggered"),this.style.display="none",this.dispatchEvent(new CustomEvent("popoverClosed"))},B.getElementTransitionDurationMS(this)+10)}},h(this,E,t=>{O(this,T,$).call(this,()=>{var x;const r=t.composedPath()[0],_=r instanceof HTMLElement&&(this.contains(r)||((x=this.shadowRoot)==null?void 0:x.contains(r))),m=r instanceof HTMLElement&&r.hasAttribute("outside");(!_||m)&&this.close()})}),h(this,L,t=>{O(this,T,$).call(this,()=>{t.code==="Escape"&&this.close()})}),h(this,g,()=>{h(this,u,!1),e(this,l).current&&e(this,p).current&&!location.search.includes(e(this,v,y))?this.close():!e(this,l).current&&e(this,p).current&&location.search.includes(e(this,v,y))&&this.open(),h(this,u,!0)}),this.setAttribute("popover-target","")}get history(){return e(this,p)}get single(){return e(this,d)}get opened(){return e(this,l)}connectedCallback(){e(this,p).observe(),e(this,d).observe(),this.style.opacity="0",this.style.display="none",addEventListener("popstate",e(this,g)),setTimeout(()=>{e(this,g).call(this)},0)}disconnectedCallback(){e(this,p).unobserve(),e(this,d).unobserve(),c.__opened=c.__opened.filter(t=>t!==this),clearTimeout(e(this,b)),removeEventListener("popstate",e(this,g))}};f=new WeakMap,l=new WeakMap,b=new WeakMap,p=new WeakMap,d=new WeakMap,u=new WeakMap,A=new WeakSet,R=function(){return`${location.pathname}${location.search?location.search+"&":"?"}${e(this,v,y)}`},v=new WeakSet,y=function(){return`modal-${this.id}`},E=new WeakMap,L=new WeakMap,T=new WeakSet,$=function(t){(c.__opened[e(this,f)-1]||c.__opened.length===1)&&t()},g=new WeakMap,c.__opened=[];let q=c;customElements.get("e-popover")||customElements.define("e-popover",q);var s,w,C,k,S;class N extends HTMLElement{constructor(){super();i(this,s,void 0);i(this,w,()=>{this.classList.add("triggered")});i(this,C,()=>{this.classList.add("opened")});i(this,k,()=>{this.classList.remove("opened")});i(this,S,()=>{this.classList.remove("triggered")});I.isBrowser&&j.element(this,{tabindex:this.getAttribute("tabindex")||"0",onClick:()=>{if(e(this,s)){const t=this.getAttribute("type")||"open";t==="open"||t==="toggle"&&!e(this,s).opened.current?e(this,s).open():(t==="close"||t==="toggle"&&e(this,s).opened.current)&&e(this,s).close()}},onKeydown:t=>{t.code==="Space"&&t.currentTarget.click()}})}get popoverElement(){return e(this,s)}connectedCallback(){var a;const t=this.getAttribute("target");if(t){let r=null;if(t==="parent"){const _=this.closest("[popover-target]");if(_)r=_;else{const m=this.getRootNode();m instanceof ShadowRoot?r=m.host.closest("[popover-target]"):m instanceof HTMLElement&&(r=m.closest("[popover-target]"))}}else t==="sibling"?r=(a=this.parentElement)==null?void 0:a.querySelector("[popover-target]"):r=document.querySelector(`#${t}`)||this.getRootNode().querySelector(`#${t}`);r instanceof HTMLElement?(h(this,s,r),e(this,s).addEventListener("popoverTriggered",e(this,w)),e(this,s).addEventListener("popoverOpened",e(this,C)),e(this,s).addEventListener("popoverClosing",e(this,k)),e(this,s).addEventListener("popoverClosed",e(this,S))):console.warn(this,`target ${t} not found`)}}disconnectedCallback(){e(this,s)&&(e(this,s).removeEventListener("popoverTriggered",e(this,w)),e(this,s).removeEventListener("popoverOpened",e(this,C)),e(this,s).removeEventListener("popoverClosing",e(this,k)),e(this,s).removeEventListener("popoverClosed",e(this,S)))}}s=new WeakMap,w=new WeakMap,C=new WeakMap,k=new WeakMap,S=new WeakMap;customElements.get("e-popover-button")||customElements.define("e-popover-button",N);exports.PopoverButtonElement=N;exports.PopoverElement=q;

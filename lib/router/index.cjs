"use strict";var it=Object.defineProperty;var $=(i,t)=>(t=Symbol[i])?t:Symbol.for("Symbol."+i);var rt=(i,t,s)=>t in i?it(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var K=(i,t,s)=>(rt(i,typeof t!="symbol"?t+"":t,s),s),J=(i,t,s)=>{if(!t.has(i))throw TypeError("Cannot "+s)};var e=(i,t,s)=>(J(i,t,"read from private field"),s?s.call(i):t.get(i)),n=(i,t,s)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,s)},o=(i,t,s,r)=>(J(i,t,"write to private field"),r?r.call(i,s):t.set(i,s),s);var Q=(i,t,s)=>(J(i,t,"access private method"),s);var W=(i,t,s)=>new Promise((r,l)=>{var a=d=>{try{f(s.next(d))}catch(T){l(T)}},u=d=>{try{f(s.throw(d))}catch(T){l(T)}},f=d=>d.done?r(d.value):Promise.resolve(d.value).then(a,u);f((s=s.apply(i,t)).next())});var V=(i,t,s)=>(t=i[$("asyncIterator")])?t.call(i):(i=i[$("iterator")](),t={},s=(r,l)=>(l=i[r])&&(t[r]=a=>new Promise((u,f,d)=>(a=l.call(i,a),d=a.done,Promise.resolve(a.value).then(T=>u({value:T,done:d}),f)))),s("next"),s("return"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const nt=require("urlpattern-polyfill"),ot=require("../notifier/index.cjs"),tt=require("../browser-QbF6EW-w.cjs"),at=require("../function-QP7IreXR.cjs"),ht=require("../custom-element/index.cjs");var R,x,b,m,c,P,S,w,v,E,Y,et;class ct{constructor(t,s){n(this,Y);n(this,R,void 0);n(this,x,void 0);n(this,b,void 0);n(this,m,void 0);n(this,c,void 0);n(this,P,void 0);n(this,S,void 0);n(this,w,null);n(this,v,[]);n(this,E,[]);o(this,R,t),o(this,x,s),o(this,b,new URLPattern({pathname:e(this,R)})),o(this,m,null),o(this,c,null),o(this,P,!1),o(this,S,null),tt.isBrowser&&o(this,w,new MutationObserver(r=>{r[0].addedNodes.forEach(a=>{e(this,m)?e(this,E).push(a):e(this,v).push(a)})}))}get pattern(){return e(this,R)}get urlPattern(){return e(this,b)}get isActive(){return e(this,P)}get element(){return e(this,c)}get outlet(){return e(this,S)}testPathname(t){return this.urlPattern.test({pathname:t})}render(t,s){return W(this,null,function*(){var r,l;if(e(this,w).observe(document.head,{childList:!0,subtree:!0}),e(this,m))e(this,v).forEach(a=>{document.head.appendChild(a)});else{const a=yield e(this,x).call(this);o(this,E,[...e(this,v)]),typeof a.default=="function"&&(o(this,m,a.default),customElements.define("e-"+((r=e(this,m))==null?void 0:r.name.toLowerCase()),a.default))}if(yield Q(this,Y,et).call(this),e(this,m)){const a=e(this,b).exec({pathname:s}),u=(a==null?void 0:a.pathname.groups)||{},f=Object.fromEntries(new URLSearchParams(location.search)),d={pathnameParams:u,searchParams:f};o(this,c,new(e(this,m))(d)),t.appendChild(e(this,c)),o(this,S,e(this,c).querySelector("[data-outlet]")||((l=e(this,c).shadowRoot)==null?void 0:l.querySelector("[data-outlet]"))||e(this,c).shadowRoot||e(this,c)),o(this,P,!0)}e(this,w).disconnect()})}close(){var t;e(this,w).disconnect(),(t=e(this,c))==null||t.remove(),o(this,P,!1),e(this,E).forEach(s=>document.head.removeChild(s)),o(this,E,[])}getAnchorElements(){var s;let t=[];return e(this,c)&&(t=[...e(this,c).querySelectorAll("a")]),(s=e(this,c))!=null&&s.shadowRoot&&(t=[...t,...e(this,c).shadowRoot.querySelectorAll("a")]),t}}R=new WeakMap,x=new WeakMap,b=new WeakMap,m=new WeakMap,c=new WeakMap,P=new WeakMap,S=new WeakMap,w=new WeakMap,v=new WeakMap,E=new WeakMap,Y=new WeakSet,et=function(){return W(this,null,function*(){const t=e(this,v).filter(u=>u instanceof HTMLElement?u.tagName==="STYLE"||u.tagName==="SCRIPT"||u.tagName==="LINK":!1);try{for(var s=V(t),r,l,a;r=!(l=yield s.next()).done;r=!1){const u=l.value;yield new Promise(f=>{u.onload=()=>{f()}})}}catch(l){a=[l]}finally{try{r&&(l=s.return)&&(yield l.call(s))}finally{if(a)throw a[0]}}})};var H,g,A,U,M;class lt{constructor(t,s){n(this,H,void 0);n(this,g,void 0);n(this,A,void 0);n(this,U,void 0);n(this,M,t=>{t.preventDefault(),e(this,H).navigate(e(this,A),e(this,U))});o(this,H,t),o(this,g,s),o(this,A,e(this,g).getAttribute("href")||"/"),o(this,U,e(this,g).getAttribute("data-history-action")||"push"),e(this,g).addEventListener("click",e(this,M)),location.pathname===e(this,A)&&e(this,g).classList.add("current")}destroy(){e(this,g).removeEventListener("click",e(this,M)),e(this,g).classList.remove("current")}}H=new WeakMap,g=new WeakMap,A=new WeakMap,U=new WeakMap,M=new WeakMap;globalThis.URLPattern=nt.URLPattern;var k,q,p,N,j,y,C,B,z,F,st,G;const O=class O{constructor(t){n(this,F);n(this,k,null);n(this,q,void 0);n(this,p,[]);n(this,N,null);n(this,j,[]);n(this,y,void 0);n(this,C,null);n(this,B,new ot.Notifier);K(this,"preprocessor");K(this,"postprocessor");n(this,z,at.debounce(()=>{const t=s=>s.split("/").length;o(this,p,e(this,p).sort((s,r)=>t(s.pattern)-t(r.pattern))),this.navigate(location.pathname.replace(e(this,q),""))},0));n(this,G,t=>{t.state&&this.navigate(t.state,"none")});o(this,q,(t==null?void 0:t.base)||""),O.active=this,tt.isBrowser&&(o(this,k,(t==null?void 0:t.rootElement)||document.body),addEventListener("popstate",e(this,G)))}get currentPathname(){return e(this,C)}get candidatePathname(){return e(this,y)}get routes(){return e(this,p)}navigationEvent(t){return e(this,B).subscribe(t)}defineRoute(t,s){const r=new ct(t,s);e(this,p).push(r),e(this,z).call(this)}navigate(t,s="push"){return W(this,null,function*(){var d,Z;if(e(this,y)===t||e(this,C)===t)return;O.active=this,o(this,y,t);const r=e(this,p).filter(h=>h.isActive),l=e(this,p).filter(h=>!r.includes(h)&&h.testPathname(t)),a=r.filter(h=>!h.testPathname(t)),u=r.filter(h=>h.testPathname(t));let f=!0;if(this.preprocessor)try{yield new Promise((h,L)=>{var _;(_=this.preprocessor)==null||_.call(this,{pathname:t,resolve:h,reject:L})})}catch(h){h?console.error(h):console.log("Route change canceled"),f=!1}if(f&&e(this,y)===t){o(this,N,u[u.length-1]),a.forEach(L=>{L.close()}),o(this,C,t);try{for(var T=V(l),mt,gt,pt;mt=!(gt=yield T.next()).done;mt=!1){const L=gt.value;yield L.render(((d=e(this,N))==null?void 0:d.outlet)||e(this,k),t),o(this,N,L)}}catch(gt){pt=[gt]}finally{try{mt&&(gt=T.return)&&(yield gt.call(T))}finally{if(pt)throw pt[0]}}const h=e(this,q)+t+location.search;s==="push"?history.pushState(h,"",h):s==="replace"&&history.replaceState(h,"",h),Q(this,F,st).call(this),(Z=this.postprocessor)==null||Z.call(this,{pathname:t}),e(this,B).notify({pathname:t})}})}};k=new WeakMap,q=new WeakMap,p=new WeakMap,N=new WeakMap,j=new WeakMap,y=new WeakMap,C=new WeakMap,B=new WeakMap,z=new WeakMap,F=new WeakSet,st=function(){const t=e(this,p).filter(r=>r.isActive),s=Array.from(new Set([...e(this,k).querySelectorAll("a"),...t.map(r=>r.getAnchorElements()).flat()].filter(r=>{var l;return(l=r.getAttribute("href"))==null?void 0:l.startsWith("/")})));e(this,j).forEach(r=>{r.destroy()}),o(this,j,s.map(r=>new lt(this,r)))},G=new WeakMap,K(O,"active");let X=O;var I,D;class ut extends ht.CustomElement{constructor(s){super();n(this,I,void 0);n(this,D,void 0);o(this,I,s.pathnameParams),o(this,D,s.searchParams)}get pathnameParams(){return e(this,I)}get searchParams(){return e(this,D)}}I=new WeakMap,D=new WeakMap;exports.RouteElement=ut;exports.Router=X;

"use strict";var b=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var r=(s,t,e)=>(b(s,t,"read from private field"),e?e.call(s):t.get(s)),a=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},i=(s,t,e,c)=>(b(s,t,"write to private field"),c?c.call(s,e):t.set(s,e),e);var w=(s,t,e)=>(b(s,t,"access private method"),e);const k=require("./browser-QbF6EW-w.cjs");var l,f,S;class z{constructor(){a(this,l,null);a(this,f,void 0);a(this,S,"");k.isBrowser&&(i(this,f,document.documentElement.getAttribute("data-project")||void 0),i(this,S,r(this,f)?r(this,f)+"-store-registry":"store-registry"))}get projectName(){return r(this,f)}get localStoreRegistryName(){return r(this,S)}get loadedState(){return r(this,l)}saveState(){const t=this.getState(),e=JSON.stringify(t);localStorage.setItem(r(this,S),e)}loadState(t=localStorage.getItem(r(this,S))){t&&(typeof t=="string"?i(this,l,JSON.parse(t)):i(this,l,t),n.current.forEach(e=>{this.updateStore(e)}))}resetState(){n.current.forEach(t=>{t.reset()}),this.saveState()}updateStore(t){var c,p;if(!Array.isArray((c=r(this,l))==null?void 0:c.stores))return t;const e=t.passport;if(e){const N=(p=r(this,l))==null?void 0:p.stores.find(A=>A.name===e.name);N&&(t.current=N.value)}return t}getState(){const t={stores:[]};return n.current.forEach(e=>{e.passport&&t.stores.push({value:e.current,name:e.passport.name})}),t}}l=new WeakMap,f=new WeakMap,S=new WeakMap;const E=new z;var u,d,g,o,y,h,m,v,q;class j{constructor(t,e){a(this,v);a(this,u,void 0);a(this,d,void 0);a(this,g,void 0);a(this,o,void 0);a(this,y,void 0);a(this,h,new Set);a(this,m,void 0);i(this,u,e==null?void 0:e.passport),i(this,d,t),i(this,g,void 0),i(this,o,t),i(this,y,(e==null?void 0:e.equalityCheck)||((c,p)=>c===p)),i(this,m,(e==null?void 0:e.validate)||(c=>c)),r(this,u)&&E.updateStore(this)}get passport(){return r(this,u)}get initial(){return r(this,d)}get previous(){return r(this,g)}get current(){return r(this,o)}set current(t){r(this,y).call(this,r(this,o),t)||(i(this,g,r(this,o)),i(this,o,r(this,m).call(this,t)),w(this,v,q).call(this))}get subscribers(){return r(this,h)}get entry(){return{current:r(this,o),previous:r(this,g)}}subscribe(t){return r(this,u)&&!r(this,h).size&&C(this),r(this,h).add(t),t(this.entry),()=>{this.unsubscribe(t)}}unsubscribe(t){r(this,h).delete(t),r(this,u)&&!r(this,h).size&&R(this)}reset(){this.current=this.initial}close(){r(this,h).clear(),r(this,u)&&R(this)}}u=new WeakMap,d=new WeakMap,g=new WeakMap,o=new WeakMap,y=new WeakMap,h=new WeakMap,m=new WeakMap,v=new WeakSet,q=function(){for(const t of r(this,h))t(this.entry)};const n=new j([]);function C(s){n.current.find(t=>t.passport.name===s.passport.name)||(n.current=[...n.current,s])}function R(s){n.current.includes(s)&&(n.current=n.current.filter(t=>t!==s))}exports.Store=j;exports.activeStores=n;exports.storeRegistry=E;

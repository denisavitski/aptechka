"use strict";var B=(r,e,s)=>{if(!e.has(r))throw TypeError("Cannot "+s)};var i=(r,e,s)=>(B(r,e,"read from private field"),s?s.call(r):e.get(r)),h=(r,e,s)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,s)},t=(r,e,s,n)=>(B(r,e,"write to private field"),n?n.call(r,s):e.set(r,s),s);var q=(r,e,s)=>(B(r,e,"access private method"),s);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const S=require("../intersector/index.cjs"),g=require("../browser-QbF6EW-w.cjs");var d,u,y,b,l,o,k;class M{constructor(e,s){h(this,d,void 0);h(this,u,void 0);h(this,y,void 0);h(this,b,0);h(this,l,0);h(this,o,!1);h(this,k,e=>{t(this,o,e.isIntersecting)});t(this,d,e),t(this,u,s==null?void 0:s.maxFPS),t(this,y,(s==null?void 0:s.order)||0),s!=null&&s.culling&&g.isBrowser?S.intersector.subscribe(s.culling,i(this,k)):t(this,o,!0)}get callback(){return i(this,d)}get order(){return i(this,y)}sync(e){t(this,b,e-i(this,l))}tick(e){if(t(this,l,Math.max(0,e-i(this,b))),i(this,u))if(i(this,l)>=1e3/i(this,u))t(this,b,e-i(this,l)%i(this,u));else return;else t(this,b,e);i(this,o)&&i(this,d).call(this,{elapsed:i(this,l),timestamp:e})}destroy(){S.intersector.unsubscribe(i(this,k))}}d=new WeakMap,u=new WeakMap,y=new WeakMap,b=new WeakMap,l=new WeakMap,o=new WeakMap,k=new WeakMap;var w,f,a,m,c,A,E,F,L,v,T;class x{constructor(){h(this,A);h(this,F);h(this,w,0);h(this,f,0);h(this,a,void 0);h(this,m,!1);h(this,c,[]);h(this,v,e=>{if(i(this,m)){t(this,m,!1),t(this,w,e-i(this,f));for(const s of i(this,c))s.sync(i(this,f))}t(this,a,requestAnimationFrame(i(this,v))),t(this,f,e-i(this,w));for(const s of i(this,c))s.tick(i(this,f))});h(this,T,()=>{document.hidden&&t(this,m,!0)});g.isBrowser&&document.addEventListener("visibilitychange",i(this,T))}subscribe(e,s){if(g.isBrowser){if(!i(this,c).find(n=>n.callback===e)){const n=new M(e,s);n.sync(performance.now()),i(this,c).push(n),t(this,c,i(this,c).sort((P,I)=>P.order-I.order))}q(this,A,E).call(this)}}unsubscribe(e){if(!g.isBrowser)return;const s=i(this,c).filter(n=>n.callback===e);s.length&&(s.forEach(n=>n.destroy()),t(this,c,i(this,c).filter(n=>n.callback!==e)),i(this,c).length||q(this,F,L).call(this))}destroy(){g.isBrowser&&(q(this,F,L).call(this),document.removeEventListener("visibilitychange",i(this,T)))}}w=new WeakMap,f=new WeakMap,a=new WeakMap,m=new WeakMap,c=new WeakMap,A=new WeakSet,E=function(){i(this,c).length&&!i(this,a)&&t(this,a,requestAnimationFrame(i(this,v)))},F=new WeakSet,L=function(){i(this,a)&&(cancelAnimationFrame(i(this,a)),t(this,a,void 0))},v=new WeakMap,T=new WeakMap;const V=new x;exports.Ticker=x;exports.ticker=V;

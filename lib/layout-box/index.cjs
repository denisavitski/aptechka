"use strict";var I=(i,e,s)=>{if(!e.has(i))throw TypeError("Cannot "+s)};var t=(i,e,s)=>(I(i,e,"read from private field"),s?s.call(i):e.get(i)),h=(i,e,s)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,s)},n=(i,e,s,l)=>(I(i,e,"write to private field"),l?l.call(i,s):e.set(i,s),s);var m=(i,e,s)=>(I(i,e,"access private method"),s);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const lt=require("../css-unit-parser/index.cjs"),V=require("../ladder/index.cjs"),G=require("../order/index.cjs"),J=require("../resizer/index.cjs"),ot=require("../scroll-entries/index.cjs"),N=require("../ticker/index.cjs"),Q=require("../browser-QbF6EW-w.cjs"),w=require("../layout-rZzbsLPd.cjs");require("../Store-txkR3wXU.cjs");require("../notifier/index.cjs");require("../function-QP7IreXR.cjs");require("../intersector/index.cjs");function j(i){const e=Math.sqrt(i.m11*i.m11+i.m12*i.m12+i.m13*i.m13),s=Math.sqrt(i.m21*i.m21+i.m22*i.m22+i.m23*i.m23),l=Math.sqrt(i.m31*i.m31+i.m32*i.m32+i.m33*i.m33),v=Math.atan2(i.m32,i.m33),Y=Math.atan2(-i.m31,Math.sqrt(i.m32*i.m32+i.m33*i.m33)),K=Math.atan2(i.m21,i.m11),u=i.m41,L=i.m42,b=i.m43;return{scaleX:e,scaleY:s,scaleZ:l,rotationX:v,rotationY:Y,rotationZ:K,translationX:u,translationY:L,translationZ:b}}var o,f,p,x,H,E,C,q,M,_,P,d,S,O,T,X,R,y,z,g,a,r,c,B,$,k,tt,D,et,U,st,Z,F,A,W;class ct{constructor(e,s){h(this,B);h(this,k);h(this,D);h(this,U);h(this,Z);h(this,o,null);h(this,f,null);h(this,p,[]);h(this,x,"auto");h(this,H,"top");h(this,E,!1);h(this,C,!0);h(this,q,!0);h(this,M,0);h(this,_,0);h(this,P,0);h(this,d,0);h(this,S,0);h(this,O,0);h(this,T,0);h(this,X,0);h(this,R,0);h(this,y,{x:0,y:0,z:0});h(this,z,{x:0,y:0,z:0});h(this,g,{x:1,y:1,z:1});h(this,a,new V.Ladder({x:0,y:0,z:0}));h(this,r,new V.Ladder({x:0,y:0,z:0}));h(this,c,new V.Ladder({x:0,y:0,z:0}));h(this,A,()=>{Q.isBrowser&&m(this,D,et).call(this)});h(this,W,()=>{m(this,U,st).call(this),m(this,B,$).call(this)});Q.isBrowser&&(n(this,o,m(this,Z,F).call(this,e)||document.body),n(this,f,m(this,Z,F).call(this,s==null?void 0:s.containerElement)||document.body),n(this,x,(s==null?void 0:s.scrollAxis)||"auto"),n(this,H,(s==null?void 0:s.frontSide)||"top"),n(this,E,(s==null?void 0:s.cartesian)||!1),n(this,C,(s==null?void 0:s.sizeStep)!==void 0?s.sizeStep:!0),n(this,q,(s==null?void 0:s.positionStep)!==void 0?s.positionStep:!0),t(this,c).setStep("_size","+",{x:1,y:1,z:1}),t(this,r).setStep("_position","+",{x:0,y:0,z:0}),t(this,c).setStep("_scale","*",{x:1,y:1,z:1}),t(this,r).setStep("_translation","+",{x:0,y:0,z:0}),t(this,a).setStep("_rotation","+",{x:0,y:0,z:0}),addEventListener("DOMContentLoaded",()=>{ot.scrollEnties.getAll(this.element).forEach(v=>{this.setScrollStep(()=>v)})}),N.ticker.subscribe(t(this,W),{order:G.TICK_ORDER.LAYOUT_BOX,culling:s!=null&&s.culling?this.element:void 0}),J.resizer.subscribe(t(this,A),G.TICK_ORDER.LAYOUT_BOX))}get element(){return t(this,o)}get containerElement(){return t(this,f)}get position(){return t(this,r).current}get rotation(){return t(this,a).current}get scale(){return t(this,c).current}get left(){return t(this,S)}get top(){return t(this,d)}get front(){return t(this,O)}get width(){return t(this,M)}get height(){return t(this,_)}get depth(){return t(this,P)}bindObject(e){e.position&&t(this,r).bind(e.position),e.rotation&&t(this,a).bind(e.rotation),e.scale&&t(this,c).bind(e.scale)}unbindObject(e){e.position&&t(this,r).unbind(e.position),e.rotation&&t(this,a).unbind(e.rotation),e.scale&&t(this,c).unbind(e.scale)}setScrollStep(e){return t(this,p).includes(e)||t(this,p).push(e),()=>this.deleteScrollStep(e)}deleteScrollStep(e){n(this,p,t(this,p).filter(s=>s!==e))}destroy(){N.ticker.unsubscribe(t(this,W)),J.resizer.unsubscribe(t(this,A)),t(this,r).close(),t(this,a).close(),t(this,c).close()}setPositionStep(...e){t(this,r).setStep(...e)}setRotationStep(...e){t(this,a).setStep(...e)}setScaleStep(...e){t(this,c).setStep(...e)}deletePositionStep(...e){t(this,r).deleteStep(...e)}deleteRotationStep(...e){t(this,a).deleteStep(...e)}deleteScaleStep(...e){t(this,c).deleteStep(...e)}}o=new WeakMap,f=new WeakMap,p=new WeakMap,x=new WeakMap,H=new WeakMap,E=new WeakMap,C=new WeakMap,q=new WeakMap,M=new WeakMap,_=new WeakMap,P=new WeakMap,d=new WeakMap,S=new WeakMap,O=new WeakMap,T=new WeakMap,X=new WeakMap,R=new WeakMap,y=new WeakMap,z=new WeakMap,g=new WeakMap,a=new WeakMap,r=new WeakMap,c=new WeakMap,B=new WeakSet,$=function(){t(this,c).calculate(),t(this,r).calculate(),t(this,a).calculate()},k=new WeakSet,tt=function(){t(this,c).setStep("_size","+",{x:t(this,C)?t(this,M):1,y:t(this,C)?t(this,_):1,z:t(this,C)?t(this,P):1});const e=t(this,q)?t(this,T):0,s=t(this,q)?t(this,X):0,l=t(this,q)?t(this,R):0;t(this,r).setStep("_position","+",{x:e,y:s,z:l}),t(this,c).setStep("_scale","*",{x:t(this,g).x,y:t(this,g).y,z:t(this,g).z}),t(this,r).setStep("_translation","+",{x:t(this,y).x,y:t(this,y).y,z:t(this,y).z}),t(this,a).setStep("_rotation","+",{x:t(this,z).x,y:t(this,z).y,z:t(this,z).z})},D=new WeakSet,et=function(){const e=getComputedStyle(t(this,o));n(this,M,Math.max(t(this,o).clientWidth,1)),n(this,_,Math.max(t(this,o).clientHeight,1)),n(this,P,Math.max(lt.cssUnitParser.parse(e.getPropertyValue("--depth")||"0px"),1));const s=w.getCumulativeOffsetLeft(t(this,f)),l=w.getCumulativeOffsetTop(t(this,f)),v=t(this,f).clientWidth,Y=t(this,f).clientHeight;if(n(this,S,w.getCumulativeOffsetLeft(t(this,o))-s),n(this,d,w.getCumulativeOffsetTop(t(this,o))-l),t(this,x)==="z"){const L=t(this,S)/v,b=t(this,d)/Y;n(this,S,(L-Math.floor(L))*v),n(this,d,(b-Math.floor(b))*Y),t(this,H)==="left"?n(this,O,w.getCumulativeOffsetLeft(t(this,o))-s-t(this,S)):n(this,O,w.getCumulativeOffsetTop(t(this,o))-l-t(this,d))}if(n(this,S,t(this,S)+t(this,o).clientLeft),n(this,d,t(this,d)+t(this,o).clientTop),t(this,E)){const L=Math.round(v/2),b=Math.round(Y/2),it=t(this,M)?Math.round(t(this,M)/2):0,ht=t(this,_)?Math.round(t(this,_)/2):0,nt=t(this,S)-L+it,rt=(t(this,d)-b+ht)*-1;n(this,T,nt),n(this,X,rt)}else n(this,T,t(this,S)),n(this,X,t(this,d));n(this,R,t(this,O)*-1);const K=new WebKitCSSMatrix(e.transform),u=j(K);t(this,y).x=u.translationX,t(this,y).y=u.translationY,t(this,y).z=u.translationZ,t(this,g).x=u.scaleX,t(this,g).y=u.scaleY,t(this,g).z=u.scaleZ,t(this,z).x=u.rotationX,t(this,z).y=u.rotationY,t(this,z).z=u.rotationZ,m(this,k,tt).call(this),m(this,B,$).call(this)},U=new WeakSet,st=function(){for(let e=0;e<t(this,p).length;e++){const s=t(this,p)[e]();let l=s.axis;t(this,x)!=="auto"&&(l=t(this,x)),t(this,r).setStep(`_scroll_${e}`,"+",{[l]:s.value*(l==="x"?-1:t(this,E)?1:-1)})}},Z=new WeakSet,F=function(e){return typeof e=="string"?document.querySelector(e):e},A=new WeakMap,W=new WeakMap;exports.LayoutBox=ct;exports.decomposeCSSMatrix=j;

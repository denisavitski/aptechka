"use strict";var G=(i,e,s)=>{if(!e.has(i))throw TypeError("Cannot "+s)};var t=(i,e,s)=>(G(i,e,"read from private field"),s?s.call(i):e.get(i)),h=(i,e,s)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,s)},r=(i,e,s,l)=>(G(i,e,"write to private field"),l?l.call(i,s):e.set(i,s),s);var O=(i,e,s)=>(G(i,e,"access private method"),s);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const ft=require("../css-unit-parser/index.cjs"),J=require("../ladder/index.cjs"),tt=require("../order/index.cjs"),Q=require("../scroll-entries/index.cjs"),et=require("../ticker/index.cjs"),st=require("../browser-CpzFX2xg.cjs"),it=require("../dom-JBOkFLTh.cjs"),L=require("../layout-8ryRAMGJ.cjs"),ht=require("../element-resizer/index.cjs"),rt=require("../window-resizer/index.cjs"),gt=require("../notifier/index.cjs");function nt(i){const e=Math.sqrt(i.m11*i.m11+i.m12*i.m12+i.m13*i.m13),s=Math.sqrt(i.m21*i.m21+i.m22*i.m22+i.m23*i.m23),l=Math.sqrt(i.m31*i.m31+i.m32*i.m32+i.m33*i.m33),m=Math.atan2(i.m32,i.m33),Z=Math.atan2(-i.m31,Math.sqrt(i.m32*i.m32+i.m33*i.m33)),F=Math.atan2(i.m21,i.m11),a=i.m41,P=i.m42*-1,q=i.m43;return{scaleX:e,scaleY:s,scaleZ:l,rotationX:m,rotationY:Z,rotationZ:F,translationX:a,translationY:P,translationZ:q}}var u,z,b,M,B,V,R,v,A,W,y,x,T,S,d,w,X,Y,k,f,g,p,o,n,c,_,E,H,U,j,K,lt,N,ct,$,ot,C,D,I;class pt{constructor(e,s){h(this,U);h(this,K);h(this,N);h(this,$);h(this,u,null);h(this,z,null);h(this,b,[]);h(this,M,"auto");h(this,B,"top");h(this,V,!1);h(this,R,!0);h(this,v,!0);h(this,A,!0);h(this,W,!0);h(this,y,0);h(this,x,0);h(this,T,0);h(this,S,0);h(this,d,0);h(this,w,0);h(this,X,0);h(this,Y,0);h(this,k,0);h(this,f,{x:0,y:0,z:0});h(this,g,{x:0,y:0,z:0});h(this,p,{x:1,y:1,z:1});h(this,o,new J.Ladder({x:0,y:0,z:0}));h(this,n,new J.Ladder({x:0,y:0,z:0}));h(this,c,new J.Ladder({x:0,y:0,z:0}));h(this,_,{x:0,y:0,z:0});h(this,E,new Map);h(this,H,new gt.Notifier);h(this,C,()=>{st.isBrowser&&O(this,N,ct).call(this)});h(this,D,()=>{O(this,$,ot).call(this),O(this,U,j).call(this)});h(this,I,()=>{const e=Q.scrollEntries.getAll(this.element);t(this,E).forEach((s,l)=>{e.includes(l)||(this.deleteScrollStep(s),t(this,E).delete(l))}),e.forEach(s=>{if(!t(this,E).has(s)){const l=()=>s;t(this,E).set(s,l),this.setScrollStep(l)}})});st.isBrowser&&(r(this,u,it.getElement(e)||document.body),r(this,z,it.getElement(s==null?void 0:s.containerElement)||document.body),r(this,M,(s==null?void 0:s.scrollAxis)||"auto"),r(this,B,(s==null?void 0:s.frontSide)||"top"),r(this,V,(s==null?void 0:s.cartesian)||!1),r(this,R,(s==null?void 0:s.sizeStep)!==void 0?s.sizeStep:!0),r(this,v,(s==null?void 0:s.positionStep)!==void 0?s.positionStep:!0),r(this,A,(s==null?void 0:s.transformStep)!==void 0?s.transformStep:!0),r(this,W,(s==null?void 0:s.scrollStep)!==void 0?s.scrollStep:!0),t(this,c).setStep("_size","+",{x:1,y:1,z:1}),t(this,n).setStep("_position","+",{x:0,y:0,z:0}),t(this,c).setStep("_scale","*",{x:1,y:1,z:1}),t(this,n).setStep("_translation","+",{x:0,y:0,z:0}),t(this,o).setStep("_rotation","+",{x:0,y:0,z:0}),t(this,W)&&(Q.scrollEntries.notifier.subscribe(t(this,I)),t(this,I).call(this)),ht.elementResizer.subscribe(this.element,t(this,C)),rt.windowResizer.subscribe(t(this,C),tt.RESIZE_ORDER.LAYOUT_BOX),et.ticker.subscribe(t(this,D),{order:tt.TICK_ORDER.LAYOUT_BOX,culling:s!=null&&s.culling?this.element:void 0}))}get element(){return t(this,u)}get containerElement(){return t(this,z)}get position(){return t(this,n).current}get rotation(){return t(this,o).current}get scale(){return t(this,c).current}get scrollValue(){return t(this,_)}get left(){return t(this,d)}get top(){return t(this,S)}get CSSTranslation(){return t(this,f)}get CSSRotation(){return t(this,g)}get CSSScale(){return t(this,p)}get front(){return t(this,w)}get width(){return t(this,y)}get height(){return t(this,x)}get depth(){return t(this,T)}destroy(){et.ticker.unsubscribe(t(this,D)),ht.elementResizer.unsubscribe(t(this,C)),rt.windowResizer.unsubscribe(t(this,C)),Q.scrollEntries.notifier.unsubscribe(t(this,I)),t(this,E).clear(),t(this,n).close(),t(this,o).close(),t(this,c).close()}bindObject(e){e.position&&t(this,n).bind(e.position),e.rotation&&t(this,o).bind(e.rotation),e.scale&&t(this,c).bind(e.scale)}unbindObject(e){e.position&&t(this,n).unbind(e.position),e.rotation&&t(this,o).unbind(e.rotation),e.scale&&t(this,c).unbind(e.scale)}setScrollStep(e){return t(this,b).includes(e)||t(this,b).push(e),()=>this.deleteScrollStep(e)}deleteScrollStep(e){r(this,b,t(this,b).filter(s=>s!==e))}setPositionStep(...e){t(this,n).setStep(...e)}getPositionStep(...e){return t(this,n).getStepValue(...e)}setRotationStep(...e){t(this,o).setStep(...e)}getRotationStep(...e){return t(this,o).getStepValue(...e)}getExcludedRotationSteps(...e){return t(this,o).getExcludedStepsValue(...e)}getIncludedRotationSteps(...e){return t(this,o).getIncludedStepsValue(...e)}setScaleStep(...e){t(this,c).setStep(...e)}getScaleStep(...e){return t(this,c).getStepValue(...e)}getExcludedScaleSteps(...e){return t(this,c).getExcludedStepsValue(...e)}getIncludedScaleSteps(...e){return t(this,c).getIncludedStepsValue(...e)}deletePositionStep(...e){t(this,n).deleteStep(...e)}getExcludedPositionSteps(...e){return t(this,n).getExcludedStepsValue(...e)}getIncludedPositionSteps(...e){return t(this,n).getIncludedStepsValue(...e)}deleteRotationStep(...e){t(this,o).deleteStep(...e)}deleteScaleStep(...e){t(this,c).deleteStep(...e)}onPosition(...e){return t(this,n).subscribe(...e)}offPosition(...e){t(this,n).unsubscribe(...e)}onScale(...e){return t(this,c).subscribe(...e)}offScale(...e){t(this,c).unsubscribe(...e)}onRotation(...e){return t(this,o).subscribe(...e)}offRotation(...e){t(this,o).unsubscribe(...e)}onResize(...e){return t(this,H).subscribe(...e)}offResize(...e){return t(this,H).unsubscribe(...e)}}u=new WeakMap,z=new WeakMap,b=new WeakMap,M=new WeakMap,B=new WeakMap,V=new WeakMap,R=new WeakMap,v=new WeakMap,A=new WeakMap,W=new WeakMap,y=new WeakMap,x=new WeakMap,T=new WeakMap,S=new WeakMap,d=new WeakMap,w=new WeakMap,X=new WeakMap,Y=new WeakMap,k=new WeakMap,f=new WeakMap,g=new WeakMap,p=new WeakMap,o=new WeakMap,n=new WeakMap,c=new WeakMap,_=new WeakMap,E=new WeakMap,H=new WeakMap,U=new WeakSet,j=function(){t(this,c).calculate(),t(this,n).calculate(),t(this,o).calculate()},K=new WeakSet,lt=function(){t(this,c).setStep("_size","+",{x:t(this,R)?t(this,y):1,y:t(this,R)?t(this,x):1,z:t(this,R)?t(this,T):1});const e=t(this,v)?t(this,X):0,s=t(this,v)?t(this,Y):0,l=t(this,v)?t(this,k):0;t(this,n).setStep("_position","+",{x:e,y:s,z:l}),t(this,A)?(t(this,c).setStep("_scale","*",{x:t(this,p).x,y:t(this,p).y,z:t(this,p).z}),t(this,n).setStep("_translation","+",{x:t(this,f).x,y:t(this,f).y,z:t(this,f).z}),t(this,o).setStep("_rotation","+",{x:t(this,g).x,y:t(this,g).y,z:t(this,g).z})):(t(this,c).setStep("_scale","*",{x:1,y:1,z:1}),t(this,n).setStep("_translation","+",{x:0,y:0,z:0}),t(this,o).setStep("_rotation","+",{x:0,y:0,z:0}))},N=new WeakSet,ct=function(){const e=getComputedStyle(t(this,u));r(this,y,Math.max(t(this,u).clientWidth,1)),r(this,x,Math.max(t(this,u).clientHeight,1)),r(this,T,Math.max(ft.cssUnitParser.parse(e.getPropertyValue("--depth")||"0px"),1));const s=L.getCumulativeOffsetLeft(t(this,z)),l=L.getCumulativeOffsetTop(t(this,z)),m=t(this,z).clientWidth,Z=t(this,z).clientHeight;if(r(this,d,L.getCumulativeOffsetLeft(t(this,u))-s),r(this,S,L.getCumulativeOffsetTop(t(this,u))-l),t(this,M)==="z"){const P=t(this,d)/m,q=t(this,S)/Z;r(this,d,(P-Math.floor(P))*m),r(this,S,(q-Math.floor(q))*Z),t(this,B)==="left"?r(this,w,L.getCumulativeOffsetLeft(t(this,u))-s-t(this,d)):r(this,w,L.getCumulativeOffsetTop(t(this,u))-l-t(this,S))}if(r(this,d,t(this,d)+t(this,u).clientLeft),r(this,S,t(this,S)+t(this,u).clientTop),t(this,V)){const P=Math.round(m/2),q=Math.round(Z/2),ut=t(this,y)?Math.round(t(this,y)/2):0,at=t(this,x)?Math.round(t(this,x)/2):0,St=t(this,d)-P+ut,dt=(t(this,S)-q+at)*-1;r(this,X,St),r(this,Y,dt)}else r(this,X,t(this,d)),r(this,Y,t(this,S));r(this,k,t(this,w)*-1);const F=new WebKitCSSMatrix(e.transform),a=nt(F);t(this,f).x=a.translationX,t(this,f).y=a.translationY,t(this,f).z=a.translationZ,t(this,p).x=a.scaleX,t(this,p).y=a.scaleY,t(this,p).z=a.scaleZ,t(this,g).x=a.rotationX,t(this,g).y=a.rotationY,t(this,g).z=a.rotationZ,O(this,K,lt).call(this),O(this,U,j).call(this),t(this,H).notify()},$=new WeakSet,ot=function(){t(this,_).x=0,t(this,_).y=0,t(this,_).z=0;for(let e=0;e<t(this,b).length;e++){const s=t(this,b)[e]();let l=s.axis;t(this,M)!=="auto"&&(l=t(this,M));const m=s.value*(l==="x"?-1:t(this,V)?1:-1);t(this,_)[l]+=m,t(this,n).setStep(`_scroll_${e}`,"+",{[l]:m})}},C=new WeakMap,D=new WeakMap,I=new WeakMap;exports.LayoutBox=pt;exports.decomposeCSSMatrix=nt;

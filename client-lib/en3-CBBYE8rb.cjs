"use strict";var ae=Object.defineProperty,ce=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var J=(h,t,i)=>t in h?ae(h,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[t]=i,O=(h,t)=>{for(var i in t||(t={}))de.call(t,i)&&J(h,i,t[i]);if(Z)for(var i of Z(t))ue.call(t,i)&&J(h,i,t[i]);return h},Q=(h,t)=>ce(h,le(t));var ee=(h,t,i)=>{if(!t.has(h))throw TypeError("Cannot "+i)};var e=(h,t,i)=>(ee(h,t,"read from private field"),i?i.call(h):t.get(h)),s=(h,t,i)=>{if(t.has(h))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(h):t.set(h,i)},r=(h,t,i,a)=>(ee(h,t,"write to private field"),a?a.call(h,i):t.set(h,i),i);const te=require("./order/index.cjs"),ie=require("./window-resizer/index.cjs"),se=require("./ticker/index.cjs"),he=require("./dom-JBOkFLTh.cjs"),x=require("three"),re=require("./layout-box/index.cjs");function ne(h){const t=i=>{i.dispose();for(const a of Object.keys(i)){const l=i[a];l&&typeof l=="object"&&"minFilter"in l&&l.dispose()}};h.traverse(i=>{if(i instanceof x.Mesh){if(i.geometry.dispose(),!Array.isArray(i.material)&&i.material.isMaterial)t(i.material);else if(Array.isArray(i.material))for(const a of i.material)t(a)}})}var V,c,p,w,y,M,R,D;class W{constructor(t,i){s(this,V,void 0);s(this,c,void 0);s(this,p,void 0);s(this,w,void 0);s(this,y,void 0);s(this,M,void 0);s(this,R,void 0);s(this,D,void 0);r(this,V,t),r(this,c,(i==null?void 0:i.cameraType)==="orthographic"?new x.OrthographicCamera:new x.PerspectiveCamera),r(this,p,new x.Scene),r(this,w,[]),r(this,y,(i==null?void 0:i.cameraDistance)||1e3),e(this,c).near=(i==null?void 0:i.cameraNear)||1,e(this,c).far=(i==null?void 0:i.cameraFar)||11e3,r(this,M,(i==null?void 0:i.cameraFov)||"auto"),e(this,c).position.z=e(this,y),e(this,c).name=`Cameras.${e(this,V)}`,r(this,R,he.getElement(i==null?void 0:i.sizeElement)||document.documentElement),this.beforeRenderCallback=i==null?void 0:i.beforeRender,r(this,D,new re.LayoutBox(e(this,R))),e(this,D).onResize(()=>{this.resize()})}get name(){return e(this,V)}get camera(){return e(this,c)}get scene(){return e(this,p)}get box(){return e(this,D)}get cameraDistance(){return e(this,y)}set cameraDistance(t){r(this,y,t),this.resize()}get sizeElement(){return e(this,R)}get isClipped(){return e(this,R)!==m.containerElement}resize(){const{width:t,height:i}=e(this,D);e(this,c).userData.controlled||(e(this,c).position.z=e(this,y)),e(this,c)instanceof x.PerspectiveCamera?(e(this,c).aspect=t/i,e(this,c).fov=e(this,M)==="auto"?2*Math.atan(i/2/e(this,y))*(180/Math.PI):e(this,c).userData.controlled?e(this,c).fov:e(this,M)):e(this,c)instanceof x.OrthographicCamera&&(e(this,c).left=t/-2,e(this,c).right=t/2,e(this,c).top=i/2,e(this,c).bottom=i/-2),e(this,c).updateProjectionMatrix()}destroy(){e(this,w).forEach(t=>{t.userData.box.destroy()}),e(this,p).clear(),ne(e(this,p)),m.destroyView(this.name),e(this,D).destroy()}attachToHTMLElement(t,i,a){const l=new re.LayoutBox(t,Q(O({},a),{containerElement:e(this,R),cartesian:!0,scrollStep:!this.isClipped}));return l.bindObject(i),i.userData.box=l,e(this,w).push(i),i}detachFromHTMLElement(t){r(this,w,e(this,w).filter(i=>i===t?(t.userData.box.destroy(),!1):!0))}add(...t){const i=t[0],a=t[1],l=t[2];return a&&this.attachToHTMLElement(a,i,l),this.scene.add(i),i}remove(t,i){this.scene.remove(t),i&&this.detachFromHTMLElement(t)}}V=new WeakMap,c=new WeakMap,p=new WeakMap,w=new WeakMap,y=new WeakMap,M=new WeakMap,R=new WeakMap,D=new WeakMap;const K=new Map;var S,k,j,z,A;class oe{constructor(t){s(this,S,void 0);s(this,k,void 0);s(this,j,void 0);s(this,z,void 0);s(this,A,void 0);r(this,S,t.targetName||void 0),r(this,k,t.eventDispatcher||t.object3D),r(this,j,t.propagation||!1),r(this,z,t.object3D),r(this,A,e(this,S)?()=>e(this,z).getObjectByName(e(this,S))||e(this,z):()=>e(this,z))}get object3D(){return e(this,z)}get eventDispatcher(){return e(this,k)}get propagation(){return e(this,j)}get target(){return e(this,A).call(this)}dispatch(t,i){this.eventDispatcher.dispatchEvent(O({originalEvent:i,type:t},this.intersection))}}S=new WeakMap,k=new WeakMap,j=new WeakMap,z=new WeakMap,A=new WeakMap;var g,u,H,F,N,q,I;class me{constructor(){s(this,g,[]);s(this,u,[]);s(this,H,new x.Vector2);s(this,F,new x.Raycaster);s(this,N,t=>{for(let i=0;i<e(this,u).length;i++)e(this,u)[i].dispatch("pointerDown",t)});s(this,q,t=>{for(let i=0;i<e(this,u).length;i++)e(this,u)[i].dispatch("pointerUp",t)});s(this,I,t=>{if(!e(this,g).length)return;e(this,H).x=t.clientX/m.width*2-1,e(this,H).y=-(t.clientY/m.height)*2+1,m.camera&&e(this,F).setFromCamera(e(this,H),m.camera);const i=[];for(const n of e(this,g)){const b=e(this,F).intersectObject(n.target);b.length&&(n.intersection=b[0],i.push(n))}let a=!1;const l=e(this,u).filter(n=>!i.find(b=>b.object3D.uuid===n.object3D.uuid)),U=i.sort((n,b)=>b.object3D.position.z-n.object3D.position.z).filter((n,b)=>a?(l.push(n),!1):(a=!n.propagation,!0)),X=U.filter(n=>!e(this,u).find(b=>b.object3D.uuid===n.object3D.uuid));for(let n=0;n<l.length;n++)l[n].dispatch("pointerLeave",t);for(let n=0;n<X.length;n++)X[n].dispatch("pointerEnter",t);r(this,u,U);for(let n=0;n<e(this,u).length;n++)e(this,u)[n].dispatch("pointerMove",t)});m.containerElement.addEventListener("pointerdown",e(this,N)),m.containerElement.addEventListener("pointerup",e(this,q)),m.containerElement.addEventListener("pointermove",e(this,I))}destroy(){m.containerElement.removeEventListener("pointerdown",e(this,N)),m.containerElement.removeEventListener("pointerup",e(this,q)),m.containerElement.removeEventListener("pointermove",e(this,I)),r(this,g,[]),r(this,u,[])}add(t,i){if(e(this,g).find(l=>l.object3D.uuid===t.uuid))return;const a=new oe(O({object3D:t},i));e(this,g).push(a)}remove(t){r(this,g,e(this,g).filter(i=>i.object3D.uuid!==t.uuid)),r(this,u,e(this,u).filter(i=>i.object3D.uuid!==t.uuid))}}g=new WeakMap,u=new WeakMap,H=new WeakMap,F=new WeakMap,N=new WeakMap,q=new WeakMap,I=new WeakMap;var G,E,d,P,o,L,C,v,_,T,B,f,Y,$;class fe{constructor(){s(this,G,`https://unpkg.com/three@0.${x.REVISION}.x`);s(this,E,null);s(this,d,null);s(this,P,null);s(this,o,new Map);s(this,L,0);s(this,C,0);s(this,v,0);s(this,_,2);s(this,T,!1);s(this,B,!1);s(this,f,null);s(this,Y,()=>{r(this,L,e(this,E).clientWidth),r(this,C,e(this,E).clientHeight),r(this,v,Math.min(e(this,_),devicePixelRatio||1)),e(this,d).setPixelRatio(e(this,v)),e(this,d).setSize(e(this,L),e(this,C)),e(this,f)&&(e(this,f).setPixelRatio(e(this,v)),e(this,f).setSize(e(this,L),e(this,C)))});s(this,$,()=>{e(this,d).setRenderTarget(null),e(this,o).forEach(t=>{this.render(t)})})}get CDNVersion(){return e(this,G)}get containerElement(){return e(this,E)}get webglRenderer(){return e(this,d)}get raycaster(){return e(this,P)}get views(){return e(this,o)}get view(){return this.getView("default")}get camera(){return this.getView("default").camera}get scene(){return this.getView("default").scene}get width(){return e(this,L)}get height(){return e(this,C)}get pixelRatio(){return e(this,v)}get cacheAssets(){return e(this,B)}get composer(){return e(this,f)}setup(t){if(e(this,T)){console.warn("[en3.setup]: You are trying to setup en3 again.");return}r(this,E,he.getElement(t==null?void 0:t.containerElement)||document.body),r(this,_,(t==null?void 0:t.maxPixelRatio)||2),r(this,d,new x.WebGLRenderer(t==null?void 0:t.webGLRendererParameters)),e(this,d).domElement.style.cssText=`
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: ${(t==null?void 0:t.zIndex)||0};
    `,(e(this,E).shadowRoot||e(this,E)).append(e(this,d).domElement),e(this,o).set("default",new W("default",O({sizeElement:e(this,E)},t==null?void 0:t.view))),r(this,P,new me),t!=null&&t.composer&&(r(this,f,new t.composer(e(this,d))),this.render=()=>{e(this,f).render()}),r(this,B,(t==null?void 0:t.cacheAssets)||!1),r(this,T,!0),ie.windowResizer.subscribe(e(this,Y),te.RESIZE_ORDER.EN3),se.ticker.subscribe(e(this,$),{order:te.TICK_ORDER.EN3})}destroy(){if(!e(this,T)){console.warn("[en3.setup]: You are trying to destory en3 but it has not been initialized.");return}ie.windowResizer.unsubscribe(e(this,Y)),se.ticker.unsubscribe(e(this,$)),e(this,P).destroy(),e(this,o).forEach(t=>{t.destroy()}),e(this,d).dispose(),e(this,d).domElement.remove(),r(this,d,null),e(this,f).dispose(),r(this,f,null),r(this,T,!1),K.forEach(t=>{t.dispose()}),K.clear()}createView(t,i){const a=e(this,o).size,l=new W(t,i);return e(this,o).set(t,l),a===1&&e(this,d).setScissorTest(!0),l}getView(t){return e(this,o).get(t)}destroyView(t){const i=e(this,o).get(t);i&&(e(this,o).delete(t),i.destroy(),e(this,o).size<=1&&e(this,d).setScissorTest(!1))}render(t){var i;if(e(this,o).size>1||this.view.isClipped){const a=t.box.left+t.box.CSSTranslation.x+t.box.scrollValue.x,l=m.height-t.box.height-t.box.top+t.box.CSSTranslation.y+t.box.scrollValue.y*-1;e(this,d).setScissor(a,l,t.box.width,t.box.height),e(this,d).setViewport(a,l,t.box.width,t.box.height)}(i=t.beforeRenderCallback)==null||i.call(t),e(this,d).render(t.scene,t.camera)}}G=new WeakMap,E=new WeakMap,d=new WeakMap,P=new WeakMap,o=new WeakMap,L=new WeakMap,C=new WeakMap,v=new WeakMap,_=new WeakMap,T=new WeakMap,B=new WeakMap,f=new WeakMap,Y=new WeakMap,$=new WeakMap;const m=new fe;exports.En3View=W;exports.dispose=ne;exports.en3=m;exports.en3Cache=K;
